<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:Kursovoy.ViewModels"
             x:Class="Kursovoy.Views.SettingsView"
             x:DataType="vm:SettingsViewModel"
             mc:Ignorable="d">

  <ScrollViewer>
    <StackPanel Spacing="20" Background="#2d2d2d" Margin="10,20,10,5">

      <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Stretch">
        <TextBlock Text="Настройки приложения" FontSize="24" FontWeight="Bold" Foreground="White" Margin="0,0,16,0"/>
        <Button Content="Сохранить настройки"
                Width="169"
                HorizontalAlignment="Center" 
                VerticalAlignment="Center" 
                Background="#4b6db1"
                Foreground="White"
                Command="{Binding SaveSettingsCommand}" />
      </StackPanel>

      <Border Background="#3a3a3a" CornerRadius="10" Padding="16">
        <StackPanel Spacing="12">
          <TextBlock Text="Параметры семестра" FontSize="18" FontWeight="Bold" Foreground="White" />

          <StackPanel Orientation="Horizontal" Spacing="10">
            <TextBlock Text="Дата начала семестра:" Width="200" Foreground="#cccccc"/>
            <DatePicker Width="300" SelectedDate="{Binding SemesterStart}" Margin="15,0,0,0"/>
          </StackPanel>

          <StackPanel Orientation="Horizontal" Spacing="10">
            <TextBlock Text="Количество учебных недель:" Width="200" Foreground="#cccccc"/>
            <NumericUpDown Minimum="1" Maximum="52" Width="110" Value="{Binding Weeks}" FormatString="F0" Margin="15,0,0,0"/>
          </StackPanel>
          <StackPanel Orientation="Horizontal" Spacing="" VerticalAlignment="Center">
            <TextBlock Text="Количество учебных дней:" Width="210" Foreground="#cccccc"/>
            <ToggleSwitch IsChecked="{Binding IsSixDayWeek}" OnContent="6 дней" OffContent="5 дней" Margin="15,0,0,0"/>
          </StackPanel>

          <TextBlock Text="Праздничные и выходные дни:" Width="300" Foreground="#cccccc" Margin="0,0,0,0"   HorizontalAlignment="Left"/>
          <ItemsControl ItemsSource="{Binding Holidays}">
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,5,0,0">
                  <DatePicker SelectedDate="{Binding Date, Mode=TwoWay}" Width="300" Margin="5,0,0,0"/>
                <Button Click="OnRemoveHolidayClicked"
                        Tag="{Binding .}"
                        Background="#4b6db1"
                        Foreground="White"
                        Width="30"
                        Height="30"
                        Padding="0">
                  <Viewbox Stretch="Uniform">
                    <Path Fill="White" Width="16" Height="16">
                      <Path.Data>
                        <StreamGeometry>
                          M3,6 L5,6 L5,13 C5,13.55 5.45,14 6,14 H10 C10.55,14 11,13.55 11,13 L11,6 L13,6 L13,5 L3,5 Z M7,12 L7,7 L8,7 L8,12 Z M9,12 L9,7 L10,7 L10,12 Z M6,4 L10,4 L10.5,5 H5.5 Z
                        </StreamGeometry>
                      </Path.Data>
                    </Path>
                  </Viewbox>
                </Button></StackPanel>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
          <Button Content="Добавить дату"
                  Command="{Binding AddHolidayCommand}"
                  Width="120"
                  Margin="0,10,0,0"
                  Background="#4b6db1"
                  Foreground="White"/>
        </StackPanel>
        
      </Border>

      <Border Background="#3a3a3a" CornerRadius="10" Padding="16">
        <StackPanel Spacing="12">
          <TextBlock Text="Параметры учебного процесса" FontSize="18" FontWeight="Bold" Foreground="White"/>
          <StackPanel Orientation="Horizontal" Spacing="10">
            <TextBlock Text="Количество пар в день:" Width="180" Foreground="#cccccc"/>
            <NumericUpDown Minimum="1" Maximum="10" Width="110" Value="{Binding PairsPerDay}" FormatString="F0" Margin="5,0,0,0" />
          </StackPanel>

          <StackPanel Orientation="Horizontal" Spacing="10">
            <TextBlock Text="Длительность пары (мин):" Width="180" Foreground="#cccccc"/>
            <NumericUpDown Increment="5" Minimum="30" Maximum="180" Width="110" Value="{Binding PairDuration}" FormatString="F0" Margin="5,0,0,0" />
          </StackPanel>

          <TextBlock Text="Перемены между парами (мин):" FontWeight="Bold" Foreground="White" Margin="0,10,0,0"/>
          <ItemsControl ItemsSource="{Binding BreaksBetweenPairs}" >
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <StackPanel Orientation="Horizontal" Spacing="30" >
                  <TextBlock Text="{Binding PairIndex, StringFormat='После {0} пары:'}" Width="160" Foreground="#aaaaaa" />
                  <NumericUpDown Increment="5" Width="110" Minimum="5" Maximum="60" Value="{Binding BreakDuration}" FormatString="F0" Margin="5"/>
                </StackPanel>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
          <TextBlock Text="Адреса учебных корпусов:" FontWeight="Bold" Foreground="White" Margin="0,10,0,0"/>

          <StackPanel>
            <TextBox Watermark="Введите адрес корпуса" Text="{Binding NewBuildingName}" Width="200" Margin="5" HorizontalAlignment="Left"/>

            <Button Content="Добавить" 
                    Command="{Binding AddBuildingCommand}"
                    CommandParameter="{Binding NewBuildingName}"
                    Margin="5" 
                    Background="#4b6db1"
                    Foreground="White"/>

            <ListBox ItemsSource="{Binding Buildings}" Margin="5">
              <ListBox.ItemTemplate>
                <DataTemplate>
                  <StackPanel Orientation="Horizontal">
                    <TextBlock Text="{Binding Name}" Width="200" Margin="5" />
                        
                    <Button Content="Удалить" 
                            Click="OnRemoveBuildingClicked"
                            Tag="{Binding}" 
                            Margin="5" 
                            Background="#4b6db1"
                            Foreground="White"/>
                  </StackPanel>
                </DataTemplate>
              </ListBox.ItemTemplate>
            </ListBox>
          </StackPanel>
        </StackPanel>
        
      </Border>

      <Border Background="#3a3a3a" CornerRadius="10" Padding="16">
        <StackPanel Spacing="10">
          <TextBlock Text="Параметры анализа" FontSize="18" FontWeight="Bold" Foreground="White"/>
    
          <ToggleSwitch Content="Указывать на окна"
                        IsChecked="{Binding ShowWindows}"
                        Foreground="White"
                        OnContent="Да" OffContent="Нет"/>
    
          <ToggleSwitch Content="Указывать на вечерние пары (5–6)"
                        IsChecked="{Binding HighlightEveningClasses}"
                        Foreground="White"
                        OnContent="Да" OffContent="Нет"/>
    
          <ToggleSwitch Content="Показывать предупреждение если у группы более 4 пар в день"
                        IsChecked="{Binding FlagOver4Pairs}"
                        Foreground="White"
                        OnContent="Да" OffContent="Нет"/>
    
          <ToggleSwitch Content="Показывать предупреждение если у группы более 6 пар в день"
                        IsChecked="{Binding FlagOver6Pairs}"
                        Foreground="White"
                        OnContent="Да" OffContent="Нет"/>
        </StackPanel>
      </Border>

      <Border Background="#3a3a3a" CornerRadius="10" Padding="16">
        <StackPanel>
          <TextBlock Text="Кэш настроек" FontSize="18" FontWeight="Bold" Foreground="White"/>
          <StackPanel Orientation="Horizontal" Spacing="10" Margin="5,10,0,0">
            <Button Background="#4b6db1" Content="Загрузить из файла" Width="153" Command="{Binding LoadCommand}"/>
            <Button Background="#4b6db1" Content="Сохранить в файл" Width="153" Command="{Binding SaveCommand}"/>
          </StackPanel>
        </StackPanel>
      </Border>

    </StackPanel>
  </ScrollViewer>
</UserControl>


